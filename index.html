<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hidden Picture Challenge</title>
    <style>
        /* --- Basic Styles --- */
        h1{font-family:'Comic Sans MS',sans-serif;font-size:2.5em;text-align:center;margin-top:20px;margin-bottom: 20px; text-shadow:1px 1px 3px rgba(0,0,0,0.3);}
        h1:hover{transform:scale(1.1);transition:transform .3s ease;}
        body{font-family:Arial,sans-serif;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;margin:0;background:#f4f4f9 url('images/background.png') center/cover no-repeat;}
        #game-area {display: flex; align-items: center; gap: 30px; margin-bottom: 20px;}

        /* --- Controls Panel Styles --- */
        #controls-container {display: flex; flex-direction: column; gap: 20px; padding: 20px 15px; background-color: rgba(255, 255, 255, 0.7); border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);}
        .control-group {display: flex; flex-direction: column; align-items: center;}
        .control-group label {font-weight: bold; margin-bottom: 5px; font-family: Arial, sans-serif;}
        .control-group input[type="range"] {width: 150px;}

        /* --- Unchanged Styles --- */
        #main-row{display:flex;align-items:center;gap:30px;}
        #button-group{display:flex;gap:15px;}
        .action-button{padding:12px 25px;font-size:18px;cursor:pointer;border:none;border-radius:5px;transition:background-color .3s ease;}
        #randomImageButton{background:#007bff;color:#fff;}
        #randomImageButton:hover{background:#0056b3;}
        #specialImageButton{background:#28a745;color:#fff;}
        #specialImageButton:hover{background:#1e7e34;}
        .loading{background:#ffc107 !important;cursor:wait !important;pointer-events:none;}
        #text-overlay{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:1000;font-family:'Comic Sans MS',sans-serif;font-size:3em;font-weight:bold;color:#fff;background:rgba(0,0,0,.8);padding:20px 40px;border-radius:10px;opacity:0;transition:opacity .3s ease-in-out;pointer-events:none;text-shadow:2px 2px 4px rgba(0,0,0,.5);}
        .show-text{opacity:1 !important;}
        #image-container {position: relative; width: 400px; height: 400px; border: 5px solid #ccc; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,.2); cursor: default; background-color: black;}
        #myImage {width: 100%; height: 100%; object-fit: cover; display: block; mask-repeat: no-repeat; -webkit-mask-repeat: no-repeat; transition: opacity 0.3s ease-in-out;}
        #myImage.hidden-effect {-webkit-mask-image: none !important; mask-image: none !important;}
        .dice-wrapper{perspective:800px;cursor:pointer;}
        .dice{width:120px;height:120px;position:relative;transform-style:preserve-3d;transition:transform .8s cubic-bezier(.2,.85,.4,1.2);}
        .dice-face{position:absolute;width:120px;height:120px;background:#fff;border:4px solid #333;border-radius:12px;display:flex;align-items:center;justify-content:center;box-shadow:inset 0 0 15px rgba(0,0,0,.2);backface-visibility:hidden;}
        .dot{position:absolute;width:22px;height:22px;background:#333;border-radius:50%;}
        .face-1 .dot:nth-child(1){ } .face-2 .dot:nth-child(1){ transform:translate(-30px,-30px); } .face-2 .dot:nth-child(2){ transform:translate(30px,30px); } .face-3 .dot:nth-child(1){ transform:translate(-30px,-30px); } .face-3 .dot:nth-child(2){ transform:translate(0,0); } .face-3 .dot:nth-child(3){ transform:translate(30px,30px); } .face-4 .dot:nth-child(1){ transform:translate(-30px,-30px); } .face-4 .dot:nth-child(2){ transform:translate(30px,-30px); } .face-4 .dot:nth-child(3){ transform:translate(-30px,30px); } .face-4 .dot:nth-child(4){ transform:translate(30px,30px); } .face-5 .dot:nth-child(1){ transform:translate(-30px,-30px); } .face-5 .dot:nth-child(2){ transform:translate(30px,-30px); } .face-5 .dot:nth-child(3){ transform:translate(0,0); } .face-5 .dot:nth-child(4){ transform:translate(-30px,30px); } .face-5 .dot:nth-child(5){ transform:translate(30px,30px); } .face-6 .dot:nth-child(1) { transform: translate(-30px, -40px); } .face-6 .dot:nth-child(2) { transform: translate(30px, -40px); } .face-6 .dot:nth-child(3) { transform: translate(-30px, 0); } .face-6 .dot:nth-child(4) { transform: translate(30px, 0); } .face-6 .dot:nth-child(5) { transform: translate(-30px, 40px); } .face-6 .dot:nth-child(6) { transform: translate(30px, 40px); }
        .front  {transform: translateZ(60px); } .back   {transform: rotateX(180deg) translateZ(60px); } .right  {transform: rotateY(90deg) translateZ(60px); } .left   {transform: rotateY(-90deg) translateZ(60px); } .top    {transform: rotateX(90deg) translateZ(60px); } .bottom {transform: rotateX(-90deg) translateZ(60px); }
        .card-container {width: 120px;height: 170px;perspective: 1000px;cursor: pointer;} .card {width: 100%;height: 100%;position: relative;transform-style: preserve-3d;transition: transform 0.7s cubic-bezier(0.4, 0.2, 0.2, 1);} .card.flipped {transform: rotateY(180deg);} .card-face {position: absolute;width: 100%;height: 100%;backface-visibility: hidden;border-radius: 12px;border: 4px solid #333;box-shadow: 0 4px 12px rgba(0,0,0,.2);display: flex;align-items: center;justify-content: center;font-family: 'Comic Sans MS', sans-serif;} .card-back {background: linear-gradient(45deg, #ff416c, #ff4b2b);color: white;font-size: 60px;font-weight: bold;} .card-front {background: #fff;color: #333;font-size: 50px;font-weight: bold;transform: rotateY(180deg);}
    </style>
</head>
<body>
    <h1>Hidden Picture Challenge</h1>

    <div id="game-area">
        <div id="controls-container">
            <div class="control-group">
                <label for="dotCountSlider">Dots: <span id="dotCountValue">5</span></label>
                <input type="range" id="dotCountSlider" min="1" max="20" value="5">
            </div>
            <div class="control-group">
                <label for="speedSlider">Speed: <span id="speedValue">2.0s</span></label>
                <input type="range" id="speedSlider" min="0.5" max="5" value="2" step="0.1">
            </div>
        </div>
        <div id="main-row">
            <div id="image-container">
                <img id="myImage" src="images/0.png" alt="Hidden Picture Challenge" class="hidden-effect">
            </div>
            <div class="dice-wrapper" id="diceWrapper"> <div class="dice" id="dice"> <div class="dice-face front face-1"><div class="dot"></div></div> <div class="dice-face back face-6"><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div> <div class="dice-face top face-2"><div class="dot"></div><div class="dot"></div></div> <div class="dice-face bottom face-5"><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div> <div class="dice-face right face-3"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div> <div class="dice-face left face-4"><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div> </div> </div>
            <div class="card-container" id="chanceCard"> <div class="card"> <div class="card-face card-back">?</div> <div class="card-face card-front" id="cardValue"></div> </div> </div>
        </div>
    </div>

    <div id="button-group">
        <button id="randomImageButton" class="action-button">New Picture</button>
        <button id="specialImageButton" class="action-button">Back To Ready</button>
    </div>
    <div id="text-overlay">NEW IMAGE</div>

    <!-- UPDATED Spotlight Script -->
    <script>
        const imageToMask = document.getElementById('myImage');
        const dotCountSlider = document.getElementById('dotCountSlider');
        const speedSlider = document.getElementById('speedSlider');
        const dotCountValue = document.getElementById('dotCountValue');
        const speedValue = document.getElementById('speedValue');

        const spotlightSettings = {
            count: parseInt(dotCountSlider.value),
            speed: parseFloat(speedSlider.value)
        };
        
        let spotlightInterval = null;

        function applySpeedTransition() {
            const transitionValue = `mask-position ${spotlightSettings.speed}s ease-in-out, -webkit-mask-position ${spotlightSettings.speed}s ease-in-out`;
            imageToMask.style.transition = transitionValue;
        }

        function moveSpotlights() {
            const containerSize = 400; const spotlightRadius = 25; const minPosition = spotlightRadius; const maxPosition = containerSize - spotlightRadius; const movementRange = maxPosition - minPosition;
            let positions = [];
            for (let i = 0; i < spotlightSettings.count; i++) {
                const randomX = Math.random() * movementRange + minPosition; const randomY = Math.random() * movementRange + minPosition; const maskX = randomX - spotlightRadius; const maskY = randomY - spotlightRadius; positions.push(`${maskX}px ${maskY}px`);
            }
            const positionsString = positions.join(', ');
            imageToMask.style.maskPosition = positionsString;
            imageToMask.style.webkitMaskPosition = positionsString;
        }

        function startSpotlight() {
            if (spotlightInterval) clearInterval(spotlightInterval);

            const singleGradient = `radial-gradient(circle 50px, black 100%, transparent 100%)`; const singleSize = `50px 50px`;
            const gradients = Array(spotlightSettings.count).fill(singleGradient).join(', '); const sizes = Array(spotlightSettings.count).fill(singleSize).join(', ');

            imageToMask.style.maskImage = gradients; imageToMask.style.webkitMaskImage = gradients; imageToMask.style.maskSize = sizes; imageToMask.style.webkitMaskSize = sizes;
            
            applySpeedTransition();
            imageToMask.classList.remove('hidden-effect');
            
            setTimeout(moveSpotlights, 10);
            const intervalTime = spotlightSettings.speed * 1000 + 500;
            spotlightInterval = setInterval(moveSpotlights, intervalTime);
        }

        function stopSpotlight() {
            // This now provides a more aggressive and complete cleanup.
            imageToMask.classList.add('hidden-effect');
            if (spotlightInterval) clearInterval(spotlightInterval);
            // Explicitly remove the mask properties to ensure a clean slate.
            imageToMask.style.maskImage = '';
            imageToMask.style.webkitMaskImage = '';
            imageToMask.style.maskSize = '';
            imageToMask.style.webkitMaskSize = '';
            imageToMask.style.maskPosition = '';
            imageToMask.style.webkitMaskPosition = '';
        }

        // --- Event Listeners for Controls ---
        dotCountSlider.addEventListener('input', () => {
            spotlightSettings.count = parseInt(dotCountSlider.value);
            dotCountValue.textContent = spotlightSettings.count;
            if (!imageToMask.classList.contains('hidden-effect')) { startSpotlight(); }
        });

        speedSlider.addEventListener('input', () => {
            spotlightSettings.speed = parseFloat(speedSlider.value);
            speedValue.textContent = `${spotlightSettings.speed.toFixed(1)}s`;
            if (!imageToMask.classList.contains('hidden-effect')) { startSpotlight(); }
        });
    </script>

    <!-- Flashcard Script (Unchanged) -->
    <script>
        const imageElement = document.getElementById('myImage'); const randomButton = document.getElementById('randomImageButton'); const specialButton = document.getElementById('specialImageButton'); const textOverlay = document.getElementById('text-overlay'); const TOTAL_IMAGES = 8; let currentImageIndex = 0; const SPECIAL_IMAGE_PATH = 'images/0.png';
        let imageBag = [];
        function createShuffledImageBag() { const initialBag = Array.from({ length: TOTAL_IMAGES }, (_, i) => i + 1); for (let i = initialBag.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [initialBag[i], initialBag[j]] = [initialBag[j], initialBag[i]]; } return initialBag; }
        imageBag = createShuffledImageBag();
        function setButtonLoading(button, originalText, isLoading) { if (isLoading) { button.classList.add('loading'); button.textContent = 'Loading...'; } else { button.classList.remove('loading'); button.textContent = originalText; } }
        imageElement.addEventListener('load', function () { textOverlay.classList.remove('show-text'); imageElement.classList.remove('image-loading'); if (randomButton.classList.contains('loading')) { setButtonLoading(randomButton, "New Picture", false); } if (specialButton.classList.contains('loading')) { setButtonLoading(specialButton, "Back To Ready", false); } });
        function changeImage(newPath) { imageElement.classList.add('image-loading'); imageElement.src = newPath; }
        randomButton.addEventListener('click', function () { if (randomButton.classList.contains('loading')) return; setButtonLoading(randomButton, "New Picture", true); textOverlay.classList.add('show-text'); startSpotlight(); setTimeout(() => { if (imageBag.length === 0) { imageBag = createShuffledImageBag(); } const newIndex = imageBag.pop(); currentImageIndex = newIndex; const newImagePath = `images/${currentImageIndex}.png`; changeImage(newImagePath); }, 500); });
        specialButton.addEventListener('click', function () { if (currentImageIndex === 0 || specialButton.classList.contains('loading')) return; setButtonLoading(specialButton, "Back To Ready", true); currentImageIndex = 0; stopSpotlight(); changeImage(SPECIAL_IMAGE_PATH); });
        stopSpotlight();
    </script>

    <!-- Dice and Card Scripts (Unchanged) -->
    <script>
        const diceWrapper = document.getElementById('diceWrapper'); const dice = document.getElementById('dice'); let spinCount = 0; const rotations = [ {x: 0,   y: 0}, {x: -90, y: 0}, {x: 0,   y: -90}, {x: 0,   y: 90}, {x: 90,  y: 0}, {x: 180, y: 0} ]; let diceBag = [];
        function createShuffledDiceBag() { const singleSet = [0, 1, 2, 3, 4, 5]; const initialBag = [...singleSet, ...singleSet, ...singleSet]; for (let i = initialBag.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [initialBag[i], initialBag[j]] = [initialBag[j], initialBag[i]]; } return initialBag; }
        diceBag = createShuffledDiceBag();
        diceWrapper.addEventListener('click', () => { if (diceBag.length === 0) { diceBag = createShuffledDiceBag(); } const faceIndex = diceBag.pop(); const targetRot = rotations[faceIndex]; spinCount += 3; const spinAngle = spinCount * 360; const finalX = spinAngle + targetRot.x; const finalY = spinAngle + targetRot.y; dice.style.transform = `rotateX(${finalX}deg) rotateY(${finalY}deg)`; });
    </script>
    <script>
        const chanceCard = document.getElementById('chanceCard'); const cardInner = chanceCard.querySelector('.card'); const cardValue = document.getElementById('cardValue'); const cardOptions = ['x2', 'x3', '+10', '+5', 'รท5', '-10', '-20'];
        chanceCard.addEventListener('click', () => { if (cardInner.classList.contains('flipped')) { cardInner.classList.remove('flipped'); } else { const randomIndex = Math.floor(Math.random() * cardOptions.length); const randomValue = cardOptions[randomIndex]; cardValue.textContent = randomValue; cardInner.classList.add('flipped'); } });
    </script>
</body>
</html>
